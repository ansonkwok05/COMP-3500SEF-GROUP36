<!DOCTYPE html>
<html>
<head>
    <title>Order Status</title>
    <script src="StateMachine.js"></script>
</head>
<body>
    <div id="app">
        <h1 id="orderId"></h1>
        <h1>-----------------------------------</h1>
        <h2 id="create"></h2>
        <h2 id="OrderAccept"></h2>
        <h2 id="FoodPrepare"></h2>
        <h2 id="RiderAccept"></h2>
        <h2 id="Delivery"></h2>
        <h2 id="OrderFinish"></h2>
        <h2 id="Cancel"></h2>
    </div>

    <script>
        const elements = {
            orderId: document.getElementById('orderId'),
            create: document.getElementById('create'),
            OrderAccept: document.getElementById('OrderAccept'),
            FoodPrepare: document.getElementById('FoodPrepare'),
            RiderAccept: document.getElementById('RiderAccept'),
            Delivery: document.getElementById('Delivery'),
            OrderFinish: document.getElementById('OrderFinish'),
            Cancel: document.getElementById('Cancel')
        };

        function updateDisplay() {
            const state = window.osm.State;
            const dates = window.osm.StateDates;

            // update order ID
            elements.orderId.textContent = "OrderID: " + state.OrderID;

            // update all states
            updateStateElement('create', 'Created', state, dates);
            updateStateElement('OrderAccept', 'OrderAccept', state, dates);
            updateStateElement('FoodPrepare', 'FoodPrepare', state, dates);
            updateStateElement('RiderAccept', 'RiderAccept', state, dates);
            updateStateElement('Delivery', 'Delivery', state, dates);
            updateStateElement('OrderFinish', 'OrderFinish', state, dates);

            // update cancel status
            if (state.Cancel === 'cancelled') {
                elements.Cancel.textContent = "Cancel: cancelled";
            } else {
                elements.Cancel.textContent = "Cancel: ";
            }
        }

        function updateStateElement(elementId, stateKey, state, dates) {
            const element = elements[elementId];

            if (state[stateKey] === 'finish') {
                element.textContent = stateKey + ": finish (" + dates[stateKey] + ")";
            } else if (state[stateKey] === 'cancelled') {
                element.textContent = stateKey + ": cancelled";
            } else if (state[stateKey] === '') {
                element.textContent = stateKey + ": ";
            } else if (state[stateKey] === 'you dont have order') {
                element.textContent = stateKey + ": you dont have order";
            } else {
                element.textContent = stateKey + ": " + state[stateKey];
            }
        }

        // show status when page loads
        window.onload = function() {
            updateDisplay();
        };

        // listen for status changes
        window.osm.onStateUpdate(function(state, dates) {
            updateDisplay();
        });
    </script>
</body>
</html>